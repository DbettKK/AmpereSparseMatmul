# PTX学习

## 常量

### Integer Constants 整型常量

每个整型常量都是`64bit`，分为有符号和无符号，由`.s64`和`.u64`定义，其中各个进制的字面量是如下定义的：

| 进制   | 表示方式                        | 例子     |
|------|-----------------------------|--------|
| 16进制 | `0[xX]{hex-digit}+U?`       | `0x14` |
| 8进制  | `0{octal digit}+U?`         | `017U` |
| 2进制  | `0[bB]{0-1}+U?`             | `0b10` |
| 10进制 | `{nonzero-digit}{digit}*U?` | `12U`  |

预定义`WARP_SZ`表示目标机器中一个`warp`中的`thread`数目
> 到现在为止，对于所有目标机器，该值一直为32

### Floating Constants 浮点型常量

浮点数都是64位的，除了用一个32位十六进制去精确表达一个单精度浮点数

| 精度  | 表示方式                   |
|-----|------------------------|
| 单精度 | `0[fF]{hex-digit}{8}`  |
| 双精度 | `0[dD]{hex-digit}{16}` |

```c
// e.g 单精度指数位 +127
mov.f32  $f3, 0F3f800000;       //  1.0
```

## 变量

变量定义

```ptx
.global .u32 loc; 
.reg .s32 i; 
.const .f32 bias[] = {-1.0, 1.0}; 
.global .u8 bg[4] = {0, 0, 0, 0}; 
.reg .v4 .f32 accel; // .v4表示长度为4的vector
.reg .pred p, q, r;
```

### Vector

`vector`只能使用`.v2`和`.v4`，长度为3时也使用`.v4`

同时整个`Vector`的长度不能超过`128bit` 即 `.v4 .f64`是不允许的

### Array

数组可以指定长度也可以不指定长度初始化
> 不指定长度时只能不指定第一维的 同时相当于通过`initializer`进行初始化

```
.local  .u16 kernel[19][19];
.shared .u8  mailbox[128];
.global .u32 index[] = { 0, 1, 2, 3, 4, 5, 6, 7 };
.global .s32 offset[][2] = { {-1, 0}, {0, -1}, {1, 0}, {0, 1} };
```

### 参数化的变量名

```ptx
.reg .b32 %r<100>; //就相当于声明了 %r0, %r1, ..., %r99
```

### `.attribute`

变量有个`.manage`属性，这个属性只能在`.global`状态空间上使用，使用了这个属性之后能召唤神龙可以将变量放置在一个虚拟空间上，这个空间主机和设备都能够访问。具体是这样使用的：

```ptx
.global .attribute(.managed) .s32 g;
.global .attribute(.managed) .u64 x; 
```

## 指令操作数

